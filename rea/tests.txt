name: Sync to S3

on:
  repository_dispatch:
  workflow_dispatch:
  # Trigger workflow on push to the second repository's test directory
  repository:
    paths:
      - 'rea'

jobs:
  sync_to_s3:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout First Repository
        uses: actions/checkout@v2

      #- name: Configure Git
      #  run: |
      #    git config --global user.email "actions@example.com"
      #    git config --global user.name "GitHub Actions"

      - name: Checkout Second Repository
        uses: actions/checkout@v2
        with:
          repository: Gaurav2327/GitTest
          path: rea
          ref: main

      - name: Sync Changes to S3
        uses: jakejarvis/s3-sync-action@master
        with:
          args: --follow-symlinks --delete --exclude '.git*/*'
        env:
          AWS_S3_BUCKET: gaurav-s3-sync-test
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          SOURCE_DIR: "rea"
          PAT: ${{ secrets.PAT_SECOND_REPO }}
